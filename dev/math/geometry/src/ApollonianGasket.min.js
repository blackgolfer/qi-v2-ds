(function(a,b){"use strict";function e(a,b,c){var d,e,f,g,h,i,j,k,l=1e-6;if(void 0===c)this.m=a,this.r=b,this.isLine=!1,this.p1=null,this.p2=null;else if(d=a,e=b,f=c,!(Math.abs(d.x*(e.y-f.y)+e.x*(f.y-d.y)+f.x*(d.y-e.y))<l))this.isLine=!1,I(e.x-d.x)<I(f.x-d.x)?(g=e,e=f,f=g):I(e.x-f.x)<I(d.x-f.x)&&(g=e,e=d,d=g),h=(e.y-d.y)/(e.x-d.x),i=(f.y-e.y)/(f.x-e.x),j=(h*i*(d.y-f.y)+i*(d.x+e.x)-h*(e.x+f.x))/(2*(i-h)),k=I(i)<l?-1/h*(j-(d.x+e.x)/2)+(d.y+e.y)/2:-1/i*(j-(e.x+f.x)/2)+(e.y+f.y)/2,this.r=Math.sqrt((j-d.x)*(j-d.x)+(k-d.y)*(k-d.y)),this.m={x:j,y:k};else if(this.isLine=!0,this.m=null,this.r=-1,!(I(d.x-e.x)<l&&I(d.y-e.y)<l))this.p1=d,this.p2=e;else if(e.x!==f.x||e.y!==f.y)this.p1=d,this.p2=f;else throw new{}("No circle or line, all points equal.")}function f(a,b){var c;for(this.point=[],c=0;c<a.length;c+=1)this.point[c]={x:a[c].x,y:a[c].y};for(this.stack=[],this.draggedPoint=-1,c=0;c<a.length;c+=1)this.stack[c]=c;this.radius=b}function g(){let b=a.devicePixelRatio||1,c=A.webkitBackingStorePixelRatio||A.mozBackingStorePixelRatio||A.msBackingStorePixelRatio||A.oBackingStorePixelRatio||A.backingStorePixelRatio||1;return b/c}function h(){let a,b,c;if(void 0===x&&(x=g()),b=1*z.parentNode.parentNode.offsetWidth,c=b,a=b*x,a!==z.width){if("undefined"!=typeof y){for(let a=0;3>a;a++)y.point[a].x=P(y.point[a].x*b*x/z.width),y.point[a].y=P(y.point[a].y*b*x/z.width);y.radius=d(b*x/50,10)}z.width=b*x,z.height=c*x,A=z.getContext("2d"),z.style.width=b+"px",z.style.height=c+"px","undefined"!=typeof y&&o()}}function l(a,b){return O((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))}function m(a){var c,d,e,f,g;for(a.pageX&&a.pageY?(c=a.pageX,d=a.pageY):(c=a.clientX+b.body.scrollLeft+b.documentElement.scrollLeft,d=a.clientY+b.body.scrollTop+b.documentElement.scrollTop),e=0,f=0,g=a.target||a.srcElement;g.offsetParent;)e+=g.offsetLeft,f+=g.offsetTop,g=g.offsetParent;return{x:c-e,y:d-f}}function n(){var a,b,c,d,e,f=!1;b=function(b){var c=b.which?3===b.which:2===b.button;return c||(a=m(b),y.update(a.x*x,a.y*x,!0),f=!0,o()),!1},c=function(b){return a=m(b),y.update(a.x*x,a.y*x,f),o(),!1},d=function(){y.release(),f=!1},e=function(){y.release(),f=!1},z.addEventListener("mousedown",b,!1),z.addEventListener("mousemove",c,!1),z.addEventListener("mouseup",d,!1),z.addEventListener("mouseout",e,!1),z.addEventListener("touchstart",function(a){a.preventDefault(),b(a.changedTouches[0])},!1),z.addEventListener("touchmove",function(a){a.preventDefault(),c(a.changedTouches[0])},!1),z.addEventListener("touchend",function(a){a.preventDefault(),d(a.changedTouches[0])},!1)}function o(){let a;if(z.width=z.width,A.lineWidth=2*x,q(),s(),null!==C[3]&&null!==C[4]){if(D)for(let a=0;4>a;a++)A.strokeStyle=j,C[a].redraw();a=[C[0],C[1],C[2],C[4]],1<C[3].r&&(D&&(A.strokeStyle=j,C[4].redraw()),u(a,G),a[3]=C[3],u(a,G))}E&&y.redraw()}function p(){var a=[],b=z.width,c=z.height,e=d(b/50,10);a[0]={x:P(.5*b),y:P(.4*c)},a[1]={x:P(.35*b),y:P(.8*c)},a[2]={x:P(.65*b),y:P(.8*c)},y=[],y=new f(a,e)}function q(){let a,b,c,d,f,g,h=[],j=y.point;for(let c=0;2>c;c++)a=M(j[c+1].y-j[c].y,j[c+1].x-j[c].x),b=M(j[(c+2)%3].y-j[c].y,j[(c+2)%3].x-j[c].x),h[c]=new e(j[c],j[c],{x:j[c].x+K((a+b)/2),y:j[c].y+J((a+b)/2)});B=h[0].intersect(h[1])[0],c=[];for(let a=0;2>a;a++)c[a]=new e(B,B,{x:B.x+(j[a+1].y-j[a].y),y:B.y-(j[a+1].x-j[a].x)});d=new e(j[0],j[0],j[1]),f=c[0].intersect(d)[0],d=new e(j[1],j[1],j[2]),g=c[1].intersect(d)[0],C[0]=new e(j[0],l(j[0],f)),C[1]=new e(j[1],l(j[1],f)),C[2]=new e(j[2],l(j[2],g))}function r(b,c){let f,g,h,i,j,k;if(null!==b&&null!==c)if(b.isLine||c.isLine){if(f=b.isLine?b:c,g=b.isLine?c:b,h=new e(g.m,2*g.r),i=h.intersect(f),null!==i)return new{x:(i[0].x+i[1].x)/2,y:(i[0].y+i[1].y)/2};}else if(j=M(c.m.y-b.m.y,c.m.x-b.m.x),k=l(c.m,b.m),0<k)return k<c.r?b.r<c.r?{x:c.m.x+c.r*(b.m.x-c.m.x)/k,y:c.m.y+c.r*(b.m.y-c.m.y)/k}:{x:c.m.x-c.r*(b.m.x-c.m.x)/k,y:c.m.y-c.r*(b.m.y-c.m.y)/k}:k<b.r?c.r<b.r?{x:b.m.x+b.r*(c.m.x-b.m.x)/k,y:b.m.y+b.r*(c.m.y-b.m.y)/k}:{x:b.m.x-b.r*(c.m.x-b.m.x)/k,y:b.m.y-b.r*(c.m.y-b.m.y)/k}:{x:b.m.x+b.r*(c.m.x-b.m.x)/k,y:b.m.y+b.r*(c.m.y-b.m.y)/k};return null}function s(){let b,c,d,f,g,h,k=[],m=[],n=y.point;for(let a=0;3>a;a++)b=M(n[(a+1)%3].y-n[a].y,n[(a+1)%3].x-n[a].x),k[a]=r(C[(a+1)%3],C[a]),m[a]=new e(C[a].m,C[a].m,C[(a+1)%3].m);c=[];for(let a=0;3>a;a++)f=new e(n[a],n[a],{x:n[a].x+(n[(a+1)%3].y-n[(a+2)%3].y),y:n[a].y-(n[(a+1)%3].x-n[(a+2)%3].x)}),c[a]=f.intersect(C[a]);d=[];for(let a=0;3>a;a++){d[a]=[];for(let b=0;2>b;b++)if(g=new e(c[a][b],c[a][b],k[(a+1)%3]),h=g.intersect(C[a]),null!==h)d[a][b]=.001>l(h[0],c[a][b])?h[1]:h[0];else return C[3]=null,void(C[4]=null)}for(let a=0;3>a;a++)l(d[a][0],B)>l(d[a][1],B)&&(h=d[a][0],d[a][0]=d[a][1],d[a][1]=h);C[3]=new e(d[0][0],d[1][0],d[2][0]),C[4]=new e(d[0][1],d[1][1],d[2][1])}function t(a,b){let c,d,f,g,h;return b.isLine?(c=a.reflect(b.p1),d=a.reflect(b.p2),new e(c,c,d)):(f={x:b.m.x+b.r,y:b.m.y},g={x:b.m.x,y:b.m.y+b.r},h={x:b.m.x,y:b.m.y-b.r},new e(a.reflect(f),a.reflect(g),a.reflect(h)))}function u(a,b){let c,d,f,g,h,l;for(let m=0;3>m;m++)c=r(a[m],a[3]),d=r(a[m],a[(m+1)%3]),f=r(a[(m+1)%3],a[3]),null!==c&&null!==d&&null!==f&&(g=new e(c,d,f),F&&(A.strokeStyle=k,g.redraw()),h=t(g,a[(m+2)%3]),2<h.r&&0<b&&(D&&(A.strokeStyle=j,!h.isLine&&h.redraw()),l=[a[m],a[(m+1)%3],a[3],h],u(l,b-1)))}function v(){var c,d,e,f,g,i,j=[],k=[],l=[];c=b.getElementById("container"),d=b.createElement("form"),d.style.textAlign="center";for(let a=0;3>a;a++)l[a]=b.createElement("div"),l[a].className="form-group",j[a]=b.createElement("input"),j[a].setAttribute("type","checkbox"),j[a].id="input"+a,j[a].className="form-check-input",k[a]=b.createElement("label"),k[a].htmlFor="input"+a,k[a].className="form-check-label",l[a].appendChild(j[a]),l[a].appendChild(k[a]),d.appendChild(l[a]);k[0].appendChild(b.createTextNode(" Show Apollonian circles   ")),j[0].name="showApollonian",j[0].value="true",j[0].checked=!0,j[0].addEventListener("change",function(){D=this.checked,o()}),k[1].appendChild(b.createTextNode(" Show perpendicular circles.  ")),j[1].name="showPerpendicular",j[1].value="false",j[1].checked=!1,j[1].addEventListener("change",function(){F=this.checked,o()}),k[2].appendChild(b.createTextNode(" Show dots.  ")),j[2].name="showDots",j[2].value="true",j[2].checked=!0,j[2].addEventListener("change",function(){E=this.checked,o()}),f=b.createElement("div"),f.style.textAlign="center",f.style.marginTop="1em",g=b.createElement("input"),g.id="depth",g.type="range",g.min=0,g.max=10,g.value=4,g.step=1,g.addEventListener("change",function(){G=parseInt(this.value),i.innerHTML=""+G,o()}),i=b.createElement("label"),i.htmlFor="depth",i.innerHTML=""+G,f.appendChild(g),f.appendChild(i),e=b.createElement("div"),e.style.textAlign="center",e.style.marginTop="1em",z=b.createElement("canvas"),z.width=100,z.height=100,z.className="border",e.appendChild(z),A=z.getContext("2d"),c.appendChild(d),c.appendChild(f),c.appendChild(e),h(),p(),n(),o(),a.addEventListener("resize",h,!1),a.addEventListener("orientationchange",h,!1)}let x,y,z,A,B,C=[],D=!0,E=!0,F=!1,G=4,H=console.log,I=Math.abs,J=Math.sin,K=Math.cos,L=Math.tan,M=Math.atan2,N=Math.acos,O=Math.sqrt,P=Math.round,Q=Math.PI,c=2*Math.PI,d=Math.max,i=Math.floor;const j="rgb(23, 56, 154)",k="rgba(242, 163, 63, 0.9)";e.prototype={intersect:function(b){var c,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[];return this.isLine&&b.isLine?(c=(b.p2.y-b.p1.y)*(this.p1.x-b.p1.x)-(b.p2.x-b.p1.x)*(this.p1.y-b.p1.y),e=(b.p2.x-b.p1.x)*(this.p2.y-this.p1.y)-(b.p2.y-b.p1.y)*(this.p2.x-this.p1.x),0===e?E=null:E[0]={x:this.p1.x+(this.p2.x-this.p1.x)*c/e,y:this.p1.y+(this.p2.y-this.p1.y)*c/e}):this.isLine&&!b.isLine||!this.isLine&&b.isLine?(f=this.isLine?b:this,g=this.isLine?this:b,i=g.p1.x-f.m.x,j=g.p1.y-f.m.y,k=g.p2.x-f.m.x,l=g.p2.y-f.m.y,m=k-i,n=l-j,o=Math.sqrt((i-k)*(i-k)+(j-l)*(j-l)),p=i*l-k*j,q=f.r*f.r*o*o-p*p,0>q?E=null:0<n?(r=(p*n+m*Math.sqrt(q))/(o*o),t=(p*n-m*Math.sqrt(q))/(o*o)):(r=(p*n-m*Math.sqrt(q))/(o*o),t=(p*n+m*Math.sqrt(q))/(o*o)),s=(-p*m+Math.abs(n)*Math.sqrt(q))/(o*o),u=(-p*m-Math.abs(n)*Math.sqrt(q))/(o*o),E[0]={x:r+f.m.x,y:s+f.m.y},E[1]={x:t+f.m.x,y:u+f.m.y}):(v=Math.sqrt((this.m.x-b.m.x)*(this.m.x-b.m.x)+(this.m.y-b.m.y)*(this.m.y-b.m.y)),0===v||v>this.r+b.r?E=null:(w=(this.r*this.r-b.r*b.r+v*v)/2/v,x=Math.sqrt(this.r*this.r-w*w),y=this.m.x+w*(b.m.x-this.m.x)/v,z=this.m.y+w*(b.m.y-this.m.y)/v,A=y+x*(b.m.y-this.m.y)/v,B=z-x*(b.m.x-this.m.x)/v,C=y-x*(b.m.y-this.m.y)/v,D=z+x*(b.m.x-this.m.x)/v,E[0]={x:A,y:B},E[1]={x:C,y:D})),E},tangent:function(a){var b;return b=this.isLine?this:new e(a,{x:a.x-(a.y-this.m.y),y:a.y-(this.m.x-a.x)},a),b},reflect:function(c){var e,f,g,h,i,j;return this.isLine?(g=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)),h=(this.p2.x-this.p1.x)/g,i=(this.p2.y-this.p2.y)/g,e=-c.x+2*this.p1.x+2*h*(this.p2.x-this.p1.x)*h,f=-c.y+2*this.p1.y+2*i*(this.p2.y-this.p1.y)*i,j={x:e,y:f}):1e-7>(c.x-this.m.x)*(c.x-this.m.x)+(c.y-this.m.y)*(c.y-this.m.y)?j=null:(e=this.m.x+this.r*this.r*(c.x-this.m.x)/((c.x-this.m.x)*(c.x-this.m.x)+(c.y-this.m.y)*(c.y-this.m.y)),f=this.m.y+this.r*this.r*(c.y-this.m.y)/((c.x-this.m.x)*(c.x-this.m.x)+(c.y-this.m.y)*(c.y-this.m.y)),j={x:e,y:f}),j},redraw:function(){this.isLine?(A.beginPath(),A.moveTo(this.p1.x,this.p1.y),A.lineTo(this.p2.x,this.p2.y),A.stroke()):(A.beginPath(),A.arc(this.m.x,this.m.y,this.r,0,c),A.stroke())}},f.prototype={update:function(a,c,d){var e,f,g=!1;for(e=0;e<this.point.length;e+=1)l(this.point[e],{x:a,y:c})<=this.radius&&(g=!0);if(b.body.style.cursor=g?"pointer":"default",d)for(f=this.stack.length-1;-1<f;f-=1)e=this.stack[f],-1===this.draggedPoint?l(this.point[e],{x:a,y:c})<=this.radius&&(this.draggedPoint=e,this.moveToLast(f)):0<a&&0<c&&a<z.width&&c<z.height&&(this.point[this.draggedPoint].x=a,this.point[this.draggedPoint].y=c)},redraw:function(){var a,b;for(b=this.radius,A.fillStyle="rgb(60, 60, 60)",A.strokeStyle="rgb(0, 0, 0)",a=0;a<this.point.length;a+=1)A.beginPath(),A.arc(this.point[this.stack[a]].x,this.point[this.stack[a]].y,b,0,c),A.fill(),A.stroke()},redrawOne:function(a,b){b.fillStyle="rgb(230, 230, 230)",b.beginPath(),b.arc(this.point[this.stack[a]].x,this.point[this.stack[a]].y,this.radius,0,c),b.fill()},release:function(){this.draggedPoint=-1,b.body.style.cursor="default"},moveToLast:function(a){var b,c=this.stack[a];for(b=a;b<this.stack.length-1;b+=1)this.stack[b]=this.stack[b+1];this.stack[this.stack.length-1]=c}},v()})(this,this.document);